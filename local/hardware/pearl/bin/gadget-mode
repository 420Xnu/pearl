#!/usr/bin/perl
-e "/boot/fixed.dtp" || exit 0;
for my $arg (@ARGV) {
    my $fh;
    my $ofh;
    open $fh, "</boot/fixed.dtp";
    open $ofh, ">/boot/fixed.dtp.new";
    while (<$fh>) {
	chomp;
	s/^(soc\.usb${arg}\@(.*?)) = \"(dual-role|host)\"$/$1 = "gadget"/;
	s/^(soc(.*?)hpm${arg}\@(.*?)) = \"(dual-role|host)\"$/$1 = "gadget"/;
	print $ofh "$_\n";
    }
    system("mv /boot/fixed.dtp.new /boot/fixed.dtp");
}
