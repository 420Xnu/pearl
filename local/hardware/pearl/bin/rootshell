#!/bin/sh
cd /
echo rootshell > persist/stage
find persist >> /file.list
cat /file.list | cpio -H newc -o > /boot/stage3.cpio
dt dtb-to-dtp /sys/firmware/fdt /boot/rootshell.dtp
dt permallocs >> /boot/rootshell.dtp
dt dtp-to-dtb /boot/rootshell.dtp /boot/rootshell.dtb
/bin/kexec -fix /boot/linux.image --dtb=/boot/rootshell.dtb --ramdisk=/boot/stage3.cpio --command-line="clk_ignore_unused maxcpus=1"
